<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>avProjDoxygen: Project/avProj/Bsw/Sys/Os/Os_scheduler.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">avProjDoxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ffd1f789ec7bd0a45fc6ad92579c5070.html">Project</a></li><li class="navelem"><a class="el" href="dir_922ec3a93220362acb6c052eeec50f2b.html">avProj</a></li><li class="navelem"><a class="el" href="dir_049f93a99a76288d022dcf0077f4e815.html">Bsw</a></li><li class="navelem"><a class="el" href="dir_fd0ab24e3b84143c7c077472e7d1b05b.html">Sys</a></li><li class="navelem"><a class="el" href="dir_de49f48c3688ab919e50786b39258ee2.html">Os</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Os_scheduler.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;stm32f3xx_hal.h&quot;</code><br />
<code>#include &quot;<a class="el" href="_os__task_8h_source.html">Os_task.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_platform___types_8h_source.html">Platform_Types.h</a>&quot;</code><br />
</div>
<p><a href="_os__scheduler_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a00f4799f980e74fbeede61f1e264740b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_os__scheduler_8h.html#a00f4799f980e74fbeede61f1e264740b">__attribute__</a> ((naked)) void Os_Scheduler_Start(void)</td></tr>
<tr class="memdesc:a00f4799f980e74fbeede61f1e264740b"><td class="mdescLeft">&#160;</td><td class="mdescRight">PendSV IRQ handler.  <br /></td></tr>
<tr class="separator:a00f4799f980e74fbeede61f1e264740b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a698a659fa941eb5e511d2d12a5603db4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_os__scheduler_8h.html#a698a659fa941eb5e511d2d12a5603db4">Os_Scheduler_Init</a> ()</td></tr>
<tr class="memdesc:a698a659fa941eb5e511d2d12a5603db4"><td class="mdescLeft">&#160;</td><td class="mdescRight">OS Scheduler initialization function.  <br /></td></tr>
<tr class="separator:a698a659fa941eb5e511d2d12a5603db4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a00f4799f980e74fbeede61f1e264740b" name="a00f4799f980e74fbeede61f1e264740b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00f4799f980e74fbeede61f1e264740b">&#9670;&#160;</a></span>__attribute__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__attribute__ </td>
          <td>(</td>
          <td class="paramtype">(naked)&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>PendSV IRQ handler. </p>
<p>OS Scheduler start function.</p>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>
<p>STEP 1 - SAVE THE CURRENT TASK CONTEXT</p>
<p>At this point the processor has already pushed PSR, PC, LR, R12, R3, R2, R1 and R0 onto the stack. We need to push the rest(i.e R4, R5, R6, R7, R8, R9, R10 &amp; R11) to save the context of the current task. Disable interrupts</p>
<p>Push registers R4 to R7</p>
<p>Push registers R8-R11</p>
<p>Load R0 with the address of pCurntTcb</p>
<p>Load R1 with the content of pCurntTcb(i.e post this, R1 will contain the address of current TCB).</p>
<p>Move the SP value to R4</p>
<p>Store the value of the stack pointer(copied in R4) to the current tasks "stackPt" element in its TCB. This marks an end to saving the context of the current task.</p>
<p>STEP 2: LOAD THE NEW TASK CONTEXT FROM ITS STACK TO THE CPU REGISTERS, UPDATE pCurntTcb.</p>
<p>Load the address of the next task TCB onto the R1.</p>
<p>Load the contents of the next tasks stack pointer to pCurntTcb, equivalent to pointing pCurntTcb to the newer tasks TCB. Remember R1 contains the address of pCurntTcb.</p>
<p>Load the newer tasks TCB to the SP using R4.</p>
<p>Pop registers R8-R11</p>
<p>Pop registers R4-R7</p>
<p>R0 contains the address of currentPt</p>
<p>R2 contains the address in currentPt(value of currentPt)</p>
<p>Load the SP reg with the stacked SP value</p>
<p>Pop registers R8-R11(user saved context)</p>
<p>Pop registers R4-R7(user saved context)</p>
<p>Start poping the stacked exception frame.</p>
<p>Skip the saved LR</p>
<p>POP the saved PC into LR via R4, We do this to jump into the first task when we execute the branch instruction to exit this routine.</p>
<p>Enable interrupts</p>

</div>
</div>
<a id="a698a659fa941eb5e511d2d12a5603db4" name="a698a659fa941eb5e511d2d12a5603db4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a698a659fa941eb5e511d2d12a5603db4">&#9670;&#160;</a></span>Os_Scheduler_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Os_Scheduler_Init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>OS Scheduler initialization function. </p>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
